
@{
    ViewBag.Title = "CustomSetupList";
}

<script>
    $(document).ready(function (data) {





        $.ajax({
            url: 'https://localhost:44378/CustomSetup/SetupPreLoad',
            type: 'POST',
            data: { Id: 1 },
            success: function (data) {
                debugger;
                var a = JSON.parse(data);
                var select = $("#customSetup");
                var selectModal = $("#customOption");

                for (var i = 0; i < a.length; i++) {
                    select.append($('<option value= "' + a[i].Id + '">' + a[i].Description + '</option>'));
                }

                for (var i = 0; i < a.length; i++) {
                    selectModal.append($('<option value= "' + a[i].Id + '">' + a[i].Description + '</option>'));
                }
            }

        });

        debugger;
        $('#table').DataTable({
            responsive: true,
            "ajax": 'https://localhost:44378/CustomSetup/GetCustomSetupList',
            "dataSrc": '',
            "columns": [
                { "data": "Id", className: "text-center" },
                { "data": "Description", className: "text-center" },
                { "data": "MasterId", className: "text-center" },
                { "data": "IsActive", className: "text-center" },
                { "data": "Action", className: "text-center" }

            ],
            dom: 'Bfrtip',
            buttons: [
                {
                    extend: 'copyHtml5',
                    text: '<i class="fa fa-files-o hoverback" style="color:blue;font-size: 20px;"></i>',
                    titleAttr: 'Copy'
                },
                {
                    extend: 'excelHtml5',
                    text: '<i class="fa fa-file-excel-o hoverback" style="color:green;font-size: 20px;"></i>',
                    titleAttr: 'Excel'
                },
                {
                    extend: 'csvHtml5',
                    text: '<i class="fa fa-file-text-o hoverback" style="color:purple;font-size: 20px;"></i>',
                    titleAttr: 'CSV'
                },
                {
                    extend: 'pdfHtml5',
                    text: '<i class="fa fa-file-pdf-o hoverback" style="color:red;font-size: 20px;"></i>',
                    titleAttr: 'PDF'
                }
            ]

        });


    });

    function BindTable(Id) {
        var setup = $('#customSetup').find(':selected').attr('value');
        debugger
        var all_d = { Id: setup }
        $.ajax({
            url: 'https://localhost:44378/CustomSetup/CustomSetupListReadById',
            type: 'GET',
            dataType: 'json',
            data: (all_d),
            async: false,
            success: function (data) {
                data = data.data
                debugger;
                $('#table').DataTable({
                    data: data,
                    "destroy": true,
                    "columns": [

                        { "data": "Id", className: "text-center" },
                        { "data": "Description", className: "text-center" },
                        { "data": "MasterId", className: "text-center" },
                        { "data": "IsActive", className: "text-center" },
                        { "data": "Action", className: "text-center" }    //edit icon color: #0080FF    //delete icon color: #DF013A

                    ],
                    dom: 'Bfrtip',
                    buttons: [
                        {
                            extend: 'copyHtml5',
                            text: '<i class="fa fa-files-o hoverback" style="color:blue;"></i>',
                            titleAttr: 'Copy'
                        },
                        {
                            extend: 'excelHtml5',
                            text: '<i class="fa fa-file-excel-o hoverback" style="color:green;"></i>',
                            titleAttr: 'Excel'
                        },
                        {
                            extend: 'csvHtml5',
                            text: '<i class="fa fa-file-text-o hoverback" style="color:purple;"></i>',
                            titleAttr: 'CSV'
                        },
                        {
                            extend: 'pdfHtml5',
                            text: '<i class="fa fa-file-pdf-o hoverback" style="color:red;"></i>',
                            titleAttr: 'PDF'
                        }
                    ]
                });

            }

        });

    }


    function Update() {
       
            var Id = $('#setupId').val();

            //with edit
            if (Id == '') {
                var Id = $('#setupId').text();
                var MasterId = $("#customOption option:selected").val(); //get selected custom setup parent value
                var Description = $('#description').val();
                var IsActive = $('#isActive').is(':checked');

                debugger;
                $.ajax({
                    url: 'https://localhost:44378/CustomSetup/CustomSetupUpdate',
                    type: 'POST',
                    data: {
                        Id: Id,
                        MasterId: MasterId,
                        Description: Description,
                        IsActive: IsActive
                    },
                    success: function (data) {

                        Swal.fire(
                            'Registered!',
                            'Your record has been registered!',
                            'success'
                        ).then(function (get) {
                            if (get.isConfirmed) {
                                location.reload();
                            }
                        });
                    },
                    error: function () {
                        swalWithBootstrapButtons.fire(
                            'Cancelled',
                            ':)',
                            'error'
                        )
                    }

                });
            }

            //new entry
            else {
                var Id = $('#setupId').text();
                let MasterId = $("#customOption option:selected").val(); //get selected custom setup parent value
                var Description = $('#description').val();
                var IsActive = $('#isActive').is(':checked');


                debugger;
                $.ajax({
                    url: 'https://localhost:44378/CustomSetup/CustomSetupUpdate',
                    type: 'POST',
                    data: {
                        Id: Id,
                        MasterId: MasterId,
                        Description: Description,
                        IsActive: IsActive

                    },
                    success: function (data) {
                        Swal.fire(
                            'Updated!',
                            'Your record has been updated!',
                            'success'
                        ).then(function (get) {
                            if (get.isConfirmed) {
                                location.reload();
                            }
                        });
                    },
                    error: function () {
                        swalWithBootstrapButtons.fire(
                            'Cancelled',
                            ':)',
                            'error'
                        )
                    }
                       
                });
            }

    }


     function Edit(a) {
        debugger;
        localStorage["CustomId"] = a;
        $('#addNew').click();
        
     }


     async function EditCustomSetup() {

     var Id = localStorage["CustomId"];
        if (Id != null) {
            console.log("Local Storage Id : " + Id);
            debugger;
           await  $.ajax({
                    url: 'https://localhost:44378/CustomSetup/CustomSetupReadById',
                    type: 'POST',
                    data: { Id: Id },
                    success: function (data) {
                        debugger;
                        var a = JSON.parse(data);
                        $('#setupId').append(a[0].Id);
                        $('#customOption').val(a[0].MasterId);
                        $('#description').val(a[0].Description);
                        if (a[0].IsActive == true) {
                            console.log(a[0].IsActive)
                            $('#isActive').prop('checked', true)
                        }
                    }

                });

        }
        localStorage.removeItem("CustomId");
    }

    function Delete(a) {
        debugger;
        localStorage["CustomId"] = a;

        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
        }).then(function (result) {
            if (result.isConfirmed) {

                var GetId = localStorage["CustomId"];
                $.ajax({
                    url: 'https://localhost:44378/CustomSetup/DeleteCustomSetupById',
                    type: 'POST',
                    data: { Id: GetId },
                    success: function (data) {
                        debugger;

                        localStorage.removeItem("CustomId");
                        Swal.fire(
                            'Deleted!',
                            'Your file has been deleted.',
                            'success'
                        ).then(function (get) {
                            if (get.isConfirmed) {
                                location.reload();
                            }
                        }); 
                    },
                    error: function () {
                        swalWithBootstrapButtons.fire(
                            'Cancelled',
                            ':)',
                            'error'
                        )
                    }

                });
            }
            else if (result.dismiss === Swal.DismissReason.cancel) {
                swalWithBootstrapButtons.fire(
                    'Cancelled',
                    ':)',
                    'error'
                )
            }
        })

    }

    function confirmDelete() {
        var GetId = localStorage["CustomId"];

        $.ajax({
            url: 'https://localhost:44378/CustomSetup/DeleteCustomSetupById',
            type: 'POST',
            data: { Id: GetId },
            success: function (data) {
                debugger;

                localStorage.removeItem("GetId");

            }

        });

        location.reload();

        localStorage.removeItem("GetId");
    }

  


</script>
<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <div class="float-end">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="#">Metrica</a>
                    </li><!--end nav-item-->
                    <li class="breadcrumb-item">
                        <a href="#">Hospital</a>
                    </li><!--end nav-item-->
                    <li class="breadcrumb-item active">Patients</li>
                </ol>
            </div>
            <h4 class="page-title">All Custom Setup</h4>
        </div><!--end page-title-box-->
    </div><!--end col-->
</div>

<div class="row">

    <div class="row">
        <div class="col-md-6 col-sm-6 col-xs-6">
            <div class="form-group row mb-2">
                <div class="col-lg-3">
                    <button id="addNew" type="button" onclick="EditCustomSetup()" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-animation="bounce" data-bs-target=".bs-example-modal-lg">+ Add New</button>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-6 col-xs-6">
            <div class="form-group row mb-3 ">
                <label class="col-md-8 col-sm-8 col-form-label text-end">Setup Type </label>
                <div class="col-md-4 col-sm-4">
                    <select onchange="BindTable(this);" class="form-select " id="customSetup">
                    </select>
                </div>
            </div><!--end form-group-->
        </div><!--end col-->
    </div><!--end row-->


    <!--<div class="col">
        <form>
            <div class="form-group row col-">
                <div class="col-md-3 mb-3">
                </div>
                <div class="col-md-3 mb-3 float-end">
                  
                </div>
            </div>
        </form>
    </div>--><!--end col-->

    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="table" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Description</th>
                                <th>MasterId</th>
                                <th>IsActive</th>
                                <th>Action</th>
                            </tr>
                        </thead>

                        <tbody>
                        </tbody>
                    </table>
                </div>


            </div><!--end card-body-->
        </div><!--end card-->
    </div> <!--end col-->
</div><!--end row-->

<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title mt-0" id="myLargeModalLabel">Add New Custom Setup</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group row">
                        <label class="col-lg-3 col-form-label text-end">ID</label>
                        <div class="col-md-6 mb-3">
                            <label class="col-lg-3 col-form-label" id="setupId"></label>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-lg-3 col-form-label text-end">Setup Type</label>
                        <div class="col-md-6 mb-3">
                            <select class="form-select" id="customOption">
                            </select>
                        </div>
                    </div>

                    <br />

                    <div class="form-group row">
                        <label class="col-lg-3 col-form-label text-end">Description</label>
                        <div class="col-md-6 mb-3">
                            <input type="text" placeholder="New Setup..." class="form-control" name="Last_Name" id="description">
                        </div>
                    </div>

                    <br />

                    <div class="form-group row">
                        <div class="col-lg-4 mb-4 col-form-label text-end">
                            <div class="form-check form-check-inline" >
                                <label class="form-check-label" for="inlineCheckbox2">IsActive</label>
                                <input class="form-check-input " type="checkbox" id="isActive">
                            </div>
                         </div>
                    </div>

                    <div class="form-group">
                        <button onclick="Update()" class="btn btn-de-primary btn-sm text-light px-4 mt-3 mb-0">Save</button>
                        <button class="btn btn-de-danger btn-sm text-light px-4 mt-3 mb-0">Cancel</button>
                    </div>
                </form>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>